# 异常点鲁棒性验证实验方法

## 实验目标

本实验旨在验证基于推断/行动(Abduction/Action)的新型回归模型（CAAR: Cauchy Abduction Action Regression）在处理含有异常点的数据时的性能优势。具体目标包括：

1. 在不同类型、不同比例的异常点存在下，验证CAAR方法相较于传统非鲁棒方法和现有鲁棒回归方法在预测性能上的显著优势。

2. 核心衡量标准是：当训练数据中包含异常点时，模型在**干净、无污染的测试集**上的预测准确性和稳定性。

## 实验范式

本实验严格遵循'训练集含异常，测试集纯净'的范式：

- **数据划分**：将所有数据集严格划分为训练集、验证集和测试集。

- **异常值注入**：仅在训练集和验证集中注入不同类型和比例的异常值。

- **测试集**：保持完全干净，不含任何人工注入的异常点，作为衡量模型最终泛化能力和鲁棒性的'黄金标准'。

## 对比方法

### 非鲁棒性/高性能基线方法

- **普通最小二乘法 (Ordinary Least Squares, OLS)**：最基础的线性回归模型，对异常值极其敏感。

- **岭回归 (Ridge Regression)**：通过L2正则化解决多重共线性，对模型参数有约束，但在异常点存在时，其对预测性能的改善有限。

- **随机森林回归 (Random Forest Regressor)**：一种强大的集成学习方法，通过多棵决策树的集成来提高预测精度和稳定性。虽然树模型对异常值有一定抵抗力，但并非专门的鲁棒算法。

### 现有鲁棒性回归方法

- **Huber 回归 (Huber Regressor)**：使用Huber损失函数，对小误差采用平方惩罚（L2），对大误差采用线性惩罚（L1），有效降低了异常点的影响，是标准的鲁棒回归基线。

- **RANSAC 回归 (Random Sample Consensus Regressor)**：通过迭代地随机选择数据子集来拟合模型，并识别内点（inliers）和外点（outliers），是处理异常点效果显著的方法。

### 我的创新方法

- **基于推断/行动的回归模型 (CAAR: Cauchy Abduction Action Regression)**：我发明的全新方法，通过推断网络和行动网络的协同工作，以及柯西分布的特性，实现了对异常点的有效处理。

## 数据集

### 合成数据

- **线性关系数据**：创建具有清晰线性关系（`y = a*x + b + noise`）的数据。

- **非线性关系数据**：创建具有非线性关系（如多项式、三角函数等）的数据。

- **异常值注入**：
  - **Y异常值**：随机选择一部分样本，将其`y`值大幅度修改，使其远离真实分布。
  - **X异常值**：随机选择一部分样本，将其某个或多个特征值大幅度修改到远离正常分布的区域。
  - **异常值比例**：设置为0%、5%、10%、20%。

### 真实数据

- **California Housing Prices Dataset**：预测房价的大型数据集，包含丰富的数值特征。

- **Diabetes Dataset**：一个小型医疗数据集，常用于机器学习教学和模型解释。

- **异常值注入**：与合成数据相同，仅在训练集和验证集中注入不同比例的异常值。

## 实验流程

1. **数据准备**：
   - 生成合成数据或加载真实数据。
   - 将数据划分为训练集、验证集和测试集。
   - 在训练集和验证集中注入不同比例的异常值。

2. **模型训练**：
   - 在受污染的训练集上训练所有对比模型和CAAR模型。
   - 使用受污染的验证集进行超参数调优。

3. **模型评估**：
   - 在干净的测试集上评估所有模型的性能。
   - 计算各种评估指标：MSE、RMSE、MAE、MdAE、R²。

4. **结果分析**：
   - 创建性能对比表格。
   - 绘制不同异常值比例下的性能趋势图。
   - 绘制残差分析图和预测值与真实值对比图。

5. **实验重复**：
   - 每个实验重复3次，使用不同的随机种子。
   - 计算平均性能和标准差，确保结果的统计可靠性。

## 评估指标

- **均方误差 (Mean Squared Error, MSE)**：评估预测误差的平方平均值。

- **均方根误差 (Root Mean Squared Error, RMSE)**：MSE的平方根，与目标变量单位一致，更直观。

- **平均绝对误差 (Mean Absolute Error, MAE)**：评估预测误差的绝对值平均值，对异常值不那么敏感。

- **中位数绝对误差 (Median Absolute Error, MdAE)**：评估预测误差绝对值的中位数，对异常值更鲁棒。

- **决定系数 (R-squared, R²)**：评估模型解释的因变量变异比例。

## CAAR模型详细介绍

### 模型架构

CAAR模型由两个核心组件构成：

#### 推断网络 (Abduction Network)

- **功能**：对于每个输入特征`x_i`，推断其在潜在表征空间中对应的'子群体'或'影响区域'。

- **输入**：观测特征`x_i`。

- **输出**：描述潜在子群体的柯西分布的参数：位置`l_i`和尺度`s_i`。

- **意义**：`U_i`的概率密度函数可以被视为一个连续的权重函数，它衡量了潜在表征空间中任意点对于解释`x_i`的'相关性'或'代表性'。

#### 行动网络 (Action Network)

- **功能**：定义从任何潜在表征`u`到最终结果`y`的确定性映射规则。

- **输入**：潜在表征空间中的一个点`u`。

- **输出**：对结果`y`的预测值。

- **结构**：采用一个简单的共享线性层：`y(u) = w^T u + b`。

### 核心机制

模型的关键在于如何结合Abduction Net推断出的子群体分布`U_i`和Action Net定义的映射规则`y(u)`来预测`y_i`的分布。利用柯西分布在线性变换下的特性：

- 对于给定的`x_i`，模型预测的`y`的条件分布`p(y | x_i)`也是一个柯西分布：
  - `p(y | x_i) = Cauchy(y; μ_y_i, γ_y_i)`
  - 其中，预测的位置参数`μ_y_i`和尺度参数`γ_y_i`由以下公式给出：
    - `μ_y_i = w^T l_i + b`
    - `γ_y_i = w_abs^T s_i`

### 损失函数与训练

使用极大似然估计（MLE）来训练整个模型。损失函数是观测数据`y_i`在模型预测的柯西分布下的负对数似然（NLL）：

```
L = -∑ log[1/(π*γ_y_i * (1 + ((y_i - μ_y_i)/γ_y_i)²))]
```

### 优势

- **鲁棒性**：假设并预测柯西分布，天然对`y`中的异常值和重尾数据具有更好的鲁棒性。

- **效率与可扩展性**：推理过程是参数化的，不依赖存储大量训练数据，更适合大规模部署和流式数据场景。

- **高维表示能力**：可以利用高维潜在空间和简单的线性Action Net，实现强大的函数拟合能力。

- **优雅的MLE框架**：巧妙利用柯西分布的代数性质，构建了一个理论上清晰且可通过极大似然直接优化的损失函数。

